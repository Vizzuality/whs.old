<div class="content_box" id="explore">
  <div class="top"></div>
  <div class="middle">
    <h1><span>More than 900 beautiful</span></h1>
    <h1 class="down"><span>places to see</span></h1>
    <div class="map_container">
      <div id="map"></div>
      <div id="zoomControl">
        <a id="zoomin" href="#"></a>
        <a id="zoomout" href="#"></a>
      </div>
    </div>
    <div id="filter">
      <form>
        <div class="input"><div class="input_left"></div><div class="input_center"><form><input id="searchText" type="text" size="20" value="Search..."/><input class="hidden" type="submit"/></form></div><div class="input_right"></div></div>
        <a id="all_selector" class="selected" href="#">All</a>
        <a id="natural_selector" href="#">Natural</a>
        <a id="cultural_selector" href="#">Cultural</a>
        <div id="criteria">
          <span><a id="criteria" href="#">Search by criteria</a></span>
          <ul>
            <li><a href=""><%= I18n.t("feature.criteria.i") %></a></li>
            <li><a href=""><%= I18n.t("feature.criteria.ii") %></a></li>
            <li><a href=""><%= I18n.t("feature.criteria.iii") %></a></li>
            <li><a href=""><%= I18n.t("feature.criteria.iv") %></a></li>
            <li><a href=""><%= I18n.t("feature.criteria.v") %></a></li>
            <li><a href=""><%= I18n.t("feature.criteria.vi") %></a></li>
            <li><a href=""><%= I18n.t("feature.criteria.vii") %></a></li>
            <li><a href=""><%= I18n.t("feature.criteria.viii") %></a></li>
            <li><a href=""><%= I18n.t("feature.criteria.ix") %></a></li>
            <li><a href=""><%= I18n.t("feature.criteria.x") %></a></li>
          </ul>
        </div>
        <a id="mosaic_selector" class="selected" href="#"></a>
        <a id="list_selector" href="#"></a>
      </form>
    </div>
    <div id="mosaic">
      <ul id="image_list">
        <% @features.each do |feature|%>
        <li class="mosaic_element<%= cycle('',' middle','', :name => 'mosaic') %>">
          <a href="/features/<%=feature.id%>">
          <div class="mosaic_element_div">
            <% if feature.gallery && feature.gallery.gallery_entries.any? %>
              <%= image_tag feature.gallery.gallery_entries.first.image.thumbnail(:small).url, :alt => feature.title %>
            <% else %>
              <img src="/images/default_mosaic.png">
            <% end %>

            <div class="mosaic_label">
              <p class="place"><%=truncate(feature.title,:length => 60, :delimiter => "...")%></p>
              <p class="distance"><%= distance_of_time_in_words_to_now(feature.distance_in_time[:time]) %> by <%= feature.distance_in_time[:type] %> from <%= @user_city %></p>
            </div>
          </div>
          </a>
        </li>
        <li class="separator<%= cycle('','',' horizontal', :name => 'separator') %>"></li>
        <% end %>
      </ul>
    </div>
    <div id="list">
      <ul id="result_list">
        <% @features.each do |feature, itinerary|%>
        <li>
          <h3><a href="/features/<%=feature.id%>"><%=truncate(feature.title,:length=>50,:delimiter=>"...") %></a></h3>

          <span class="description">A <%=feature.type %> site at <%=feature.country%> (3 hours away from Madrid)</span>
          <!--
          <span class="distance">3 hours from Madrid</span>
          <span class="type"><%=feature.type %></span>
          <span class="country"><%=feature.country %></span>
        -->
        </li>
        <% end %>
      </ul>
    </div>
  </div>
  <div class="bottom"></div>
</div>

<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>

<script type="text/javascript">

  $(document).ready( function(){

    $('body').click(function() {
      $("div#criteria ul").hide();      
      $("div#criteria span").css("backgroundPosition","-2px 0");
    });

    $("a#all_selector").click(function(ev) {
      ev.stopPropagation();
      ev.preventDefault();
      $("a#all_selector").addClass("selected");
      $("a#cultural_selector").removeClass("selected");
      $("a#natural_selector").removeClass("selected");
    });

    $("a#natural_selector").click(function(ev) {
      ev.stopPropagation();
      ev.preventDefault();
      $("a#all_selector").removeClass("selected");
      $("a#cultural_selector").removeClass("selected");
      $("a#natural_selector").addClass("selected");
    });

    $("a#cultural_selector").click(function(ev) {
      ev.stopPropagation();
      ev.preventDefault();
      $("a#all_selector").removeClass("selected");
      $("a#cultural_selector").addClass("selected");
      $("a#natural_selector").removeClass("selected");
    });

    $("a#mosaic_selector").click(function(ev) {
      ev.stopPropagation();
      ev.preventDefault();
      $("a#mosaic_selector").addClass("selected");
      $("a#list_selector").removeClass("selected");

      $("div#explore div.middle div#list").hide();
      $("div#explore div.middle div#mosaic").show();
    });


    $("a#list_selector").click(function(ev) {
      ev.stopPropagation();
      ev.preventDefault();
      $("a#mosaic_selector").removeClass("selected");
      $("a#list_selector").addClass("selected");

      $("div#explore div.middle div#list").show();
      $("div#explore div.middle div#mosaic").hide();
    });


    $("a#criteria").click(function(ev) {
      ev.stopPropagation();
      ev.preventDefault();
      if ($("div#criteria ul").is(":visible")) {
        $("div#criteria span").css("backgroundPosition","-2px 0");
      } else {
        $("div#criteria span").css("backgroundPosition","-2px -24px");
      }
      $("div#criteria ul").toggle();
    });

    $("div#criteria ul a").click(function(ev) {
      ev.stopPropagation();
      ev.preventDefault();
      $("div#criteria span").css("backgroundPosition","-2px 0");
      $("div#criteria ul").toggle();
      $("a#criteria").text($(this).text());
    });


    $("div#map").mouseover(function() {
      $("h1").hide();
    });

    $("div#map").mouseout(function() {
      $("h1").show();
    });

    var myOptions = {
      zoom: 2,
      disableDefaultUI: true,
      center: new google.maps.LatLng(40,10),
      mapTypeId: google.maps.MapTypeId.TERRAIN
    };
    var map = new google.maps.Map(document.getElementById("map"), myOptions);

    var marker;
    var latlng;

    <% @features.each do |feature|%>
      latlng = new google.maps.LatLng(<%= feature.lat %>, <%= feature.lon %>);
      marker = new google.maps.Marker({
        position: latlng,
        map: map,
        title:"<%=feature.title%>",
        icon: "/images/explore/marker_<%=feature.type%>.png"
      });
      google.maps.event.addListener(marker, "click", function() {window.location = "/features/<%=feature.id%>"});
    <% end %>

  });
</script>


