<div class="content_box" id="feature">
  <div class="top"></div>
  <div class="middle">
    <div id="feature_image">

      <div id="feature_title">
        <p id="country"><span><img class="flag" src="/images/flags/<%=@feature.iso_code%>.png"/><%= @feature.country %></span></p>
        <h1><span><%= @feature.title %></span></h1>
        <p class="distance"><span id="walking">Just 13 hours away from Madrid by plane</span></p>
      </div>

      <% if @feature.gallery && @feature.gallery.gallery_entries.any? %>
      
        <ul class="image_selector">
        <% @feature.gallery.gallery_entries.each_with_index do |gallery_entry,i| %>
          <li><a href="javascript:view_image('<%=i%>')"></a></li>
        <% end %>
        </ul>      
      
        <div class="images">
          <%#= image_tag @feature.gallery.gallery_entries.first.image.thumbnail(:large).url, :alt => @feature.title %>

          <% @feature.gallery.gallery_entries.each_with_index do |gallery_entry,i| %>
            <div class="image  <% if (i == 0)%>first_image<% end%>" id="image_<%=i%>">
              <%= image_tag gallery_entry.image.thumbnail(:large).url, :alt => @feature.title %>
            </div>
          <% end %>          
        </div>
        
        <%# @feature.gallery.gallery_entries.each do |gallery_entry| %>
          <%#= image_tag gallery_entry.image.thumbnail(:large).url, :alt => @feature.title, :style => 'display: none' %>
        <%# end %>
        
      <% else %>
        <div class="images">
          <div class="image">
            <img src="/images/test/test_big.jpg"/>
          </div>
        </div>          
      <% end %>
      
      <div id="big_map_container"><div id="big_map"></div></div>

    <% if @feature.endangered_year %>
      <div id="endangered"></div>
    <% end %>
    </div>
    
      <div class="content">
        <div id="main_area">
          <p><%= simple_format @feature.description %></p>
        </div>
        <div id="data_column">
          <div class="map_container">
            <div id="map">
              <img src="http://maps.google.com/maps/api/staticmap?center=<%=@feature.the_geom.y%>,<%=@feature.the_geom.x%>&zoom=8&size=235x162&maptype=roadmap&markers=icon:/images/explore/marker_natural.png|<%=@feature.the_geom.y%>,<%=@feature.the_geom.x%>&sensor=false"/>
            
            </div>
            <div id="img_thumb"><img src="/images/test/test_thumb.jpg"/></div>
            <div id="darken">
              <a href="#"><img src="/images/darken.png"/></a>
              <a href="#" id="show_link">Show map</a>
            </div>
          </div>
          <p class="label" id="first">Date of inscription</p>
          <p class="value"><%= @feature.date_of_inscription %></p>

          <% unless @feature.criteria.blank? %>
          <span class="line"></span>
          <p class="label">Why it is a World Heritage Site</p>
          <% @feature.criteria.split(",").each do |criteria|%>
          <ul>
            <li><%= I18n.t("feature.criteria.#{criteria}") %></li>
          </ul>
          <% end %>
          <% end %>

          <% unless @feature.size.blank? %>
          <span class="line"></span>
          <p class="label">Size</p>

          <% %>
          <p class="value"><%= number_with_precision(@feature.size.to_f, :precision => 2) %> Ha</p>
          <% end %>

          <span class="line"></span>
          <p class="label">External links</p>
          <ul>
            <li><a href="<%=@feature.whs_source_page%>">Official Unesco WHS Site</a></li>
          </ul>
        </div>

        <div id="clear"></div>
      </div>
  </div>
  <div class="bottom"></div>
</div>


<div class="content_box" id="feature_mosaic">
  <div class="top"></div>
  <div class="middle">
    <div class="content">

    <div id="mosaic">
      <ul id="image_list">
        <li class="mosaic_element">
          <a href="/features/">
          <div class="mosaic_element_div">
            <img src="/images/test/test_small.jpg">
            <div class="mosaic_label">
              <p class="place">Acropolis</p>
              <p class="distance">4 hours by car from Madrid</p>
            </div>
          </div>
          </a>
        </li>
        <li class="separator"></li>
        <li class="mosaic_element middle">
          <a href="/features/">
          <div class="mosaic_element_div">
            <img src="/images/test/test_small.jpg">
            <div class="mosaic_label">
              <p class="place">Acropolis</p>
              <p class="distance">4 hours by car from Madrid</p>
            </div>
          </div>
          </a>
        </li>
        <li class="separator"></li>
        <li class="mosaic_element">
          <a href="/features/">
          <div class="mosaic_element_div">
            <img src="/images/test/test_small.jpg">
            <div class="mosaic_label">
              <p class="place">Acropolis</p>
              <p class="distance">4 hours by car from Madrid</p>
            </div>
          </div>
          </a>
        </li>
      </ul>
  </div>


    </div>
  </div>
  <div class="bottom"></div>
</div>

<div class="content_box" id="teleport">
  <div class="top"></div>
  <div class="middle">
    <div class="content">
      <div id="message">Or would you rather be randomly teleported to a new beautiful site?</div>
      <%= link_to '"Bean me up, Scotty!"', feature_path(@random_feature), :class => "teleport"  , :id => 'green'%>
    </div>
  </div>
  <div class="bottom"></div>
</div>

<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>

<script type="text/javascript">
  
  function view_image(i) {
    $("div.images div").css("z-index","5");
    $("div.images div#image_"+i).css("z-index","6");
  }
  
  $(document).ready( function(){

    $("div.map_container").mouseover(function() {
      $("div#darken").show();
      $("a#show_link").show();      
    });

    $("div.map_container").mouseout(function() {
      $("div#darken").hide();
      $("a#show_link").hide();
    });

    $("div.map_container div#darken a").click(function(ev) {
      ev.stopPropagation();
      ev.preventDefault();
      if ($("div#img_thumb").is(":visible")) {
        $("div#img_thumb").hide();
        $("a#show_link").html("Show map");
        $("div.images").show();
        $("ul.image_selector").show();              
      } else {
        $("div#img_thumb").show();
        $("a#show_link").html("Show images");       
        $("ul.image_selector").hide();              
        $("div.images").hide();
      } 
    });
    
    var myOptions = {
      zoom: 5,
      disableDefaultUI: true,
      center: new google.maps.LatLng(<%=@feature.the_geom.y%>,<%=@feature.the_geom.x%>),
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    var map = new google.maps.Map(document.getElementById("big_map"), myOptions);

    latlng = new google.maps.LatLng(<%=@feature.the_geom.y%>, <%=@feature.the_geom.x%>);
    marker = new google.maps.Marker({
      position: latlng, 
      map: map, 
      title:"<%=@feature.title%>",
      icon: "/images/explore/marker_<%=@feature.type%>.png"
    });
    google.maps.event.addListener(marker, "click", function() {window.location = "/features/<%=@feature.id%>"});

    var map_style = [
      {featureType: "administrative",elementType: "geometry",stylers: [{ visibility: "off" }]},
	    {featureType: "poi",elementType: "all",stylers: [{ visibility: "off" }]},
	    {featureType: "road",elementType: "all",stylers: [{ visibility: "off" }]},
	    {featureType: "transit",elementType: "all",stylers: [{ visibility: "off" }]},
	    {featureType: "landscape.natural",elementType: "all",stylers: [{ visibility: "off" }]},
	    {featureType: "water",elementType: "all",stylers: [{ lightness: 30 },{ saturation: -47 },{ gamma: 0.6 },{ hue: "#0088ff" }]}
    ];
    
    var styledMap =  new google.maps.StyledMapType(map_style,{map: map,name: "My Style"});
    map.mapTypes.set('my Style', styledMap);
    map.setMapTypeId('my Style');
    

  });

</script>

